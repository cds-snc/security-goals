steps:
  - name: "gcr.io/cloud-builders/npm"
    args: ["install"]
  - name: "gcr.io/cloud-builders/npm"
    args: ["test"]
  - name: "gcr.io/cloud-builders/docker"
    id: push_docker_hub
    entrypoint: "bash"
    args:
      - "-c"
      - |
        if [[ "$BRANCH_NAME" == "master" ]]; then cd /workspace && docker build -t cdssnc/compliance-ui:$REVISION_ID . && docker login docker.io -u $$DOCKER_USERNAME -p $$DOCKER_PASSWORD && docker push cdssnc/compliance-ui:$REVISION_ID; else exit 0; fi
    secretEnv: ["DOCKER_USERNAME", "DOCKER_PASSWORD"]
secrets:
  - kmsKeyName: projects/exalted-point-220022/locations/global/keyRings/cds-comp-ui-r/cryptoKeys/platform
    secretEnv:
      DOCKER_USERNAME: CiQA7osyOc3XugnK8OYWm4V4KSgAtZQbJmG5xZQYeZ1rX25oKsoSMQCn7uhHu+JHJkXwSRkKYtVIjbDQV4TpRll9bDP33NcVq63nrK89RE6YgOdxddNP33Y=
      DOCKER_PASSWORD: CiQA7osyOSSJizTZmOg4Cb4wp84GXJb8cf5Ke6fPONHAH8fKq5MSMQCn7uhH9pBGMeKiFZ4G8NlkV1xITMxtW4QgHwjEh0eqykgsY0jjIa78tGADxdL7rg0=
